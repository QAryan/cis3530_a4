<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
    <title>{{ title }}</title>
    <style>
      /* Local-only tweaks to match global theme */
      .details-card { width: 92%; margin: 0 auto; background: #fff; padding: 20px; border-radius: 6px; box-shadow: 0 2px 5px rgba(0,0,0,0.08); }
      .back-link { display: inline-block; margin-bottom: 16px; color: #2c5ea9; text-decoration: none; }
      .back-link:hover { text-decoration: underline; }
      .info-row { display: flex; padding: 10px 0; border-bottom: 1px solid #ddd; }
      .info-row:last-child { border-bottom: none; }
      .info-label { font-weight: 600; width: 220px; color: #333; }
      .info-value { flex: 1; color: #333; }
      table { width: 92%; margin: 10px auto; border-collapse: collapse; }
      th, td { border: 1px solid #ddd; padding: 8px; }
      th { background-color: #2c5ea9; color: #fff; }
      td.num, th.num { text-align: right; }
    </style>
</head>
<body>
    <div class="header">
      <h1>MyCompany</h1>
      <div class="tabs">
          <button class="tab" onclick="location.href='/'">Employees</button>
          <button class="tab-hovered" onclick="location.href='/projects'">Projects</button>
          <button class="tab" onclick="location.href='/departments'">Departments</button>
          <button class="tab" onclick="location.href='/employee_management'">Employee Management</button>
      </div>
      <div class="login-section">
        {% if user == None %}
            <button class="login-button" onclick="location.href='/login'">Login</button>
            <p>or</p>
            <button class="login-button" onclick="location.href='/register'">Register</button>
        {% else %}
            <p class="login-user">{{ user.name }}</p>
            <button class="login-button" onclick="location.href='/logout'">Logout</button>
        {% endif %}
      </div>
    </div>

    <div class="spacer"></div>

    <h1 style="width:92%; margin:0 auto 10px;">Project Details</h1>

    {% with messages = get_flashed_messages(with_categories=true) %}
      {% if messages %}
        <ul class="flashes">
        {% for category, message in messages %}
          <li class="{{ category }}">{{ message }}</li>
        {% endfor %}
        </ul>
      {% endif %}
    {% endwith %}

    <div style="width:92%; margin:0 auto 10px;">
        <a class="back-link" href="/projects">‚Üê Back to Projects List</a>
    </div>

    {% if project %}
        <div class="details-card">
            <h2 style="margin:0 0 10px;">{{ project.pname }}</h2>
            <div class="info-row">
                <div class="info-label">Project Number:</div>
                <div class="info-value">{{ project.pnumber }}</div>
            </div>
            <div class="info-row">
                <div class="info-label">Location:</div>
                <div class="info-value">{{ project.plocation }}</div>
            </div>
            <div class="info-row">
                <div class="info-label">Department:</div>
                <div class="info-value">{{ project.department_name }}</div>
            </div>
            <div class="info-row">
                <div class="info-label">Headcount:</div>
                <div class="info-value">{{ project.headcount }} employee(s)</div>
            </div>
            <div class="info-row">
                <div class="info-label">Total Assigned Hours:</div>
                <div class="info-value">{{ "%.2f"|format(project.total_hours) }} hours</div>
            </div>
        </div>

        <h3>Employees Working on This Project</h3>
        
        {% if employees %}
            <table>
                <thead>
                    <tr>
                        <th>Employee</th>
                        <th class="num">Hours Worked</th>
                    </tr>
                </thead>
                <tbody>
                    {% for emp in employees %}
                    <tr>
                        <td>{{ emp.fname }} {{ emp.lname }}</td>
                        <td class="num">{{ "%.2f"|format(emp.hours) }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        {% else %}
            <p>No employees assigned to this project.</p>
        {% endif %}

        <div class="details-card" style="margin-top:14px;">
            <h3 style="margin:0 0 12px;">Assign or Add Hours</h3>
            <form method="POST" action="">
                <div class="info-row">
                    <div class="info-label">Employee</div>
                    <div class="info-value">
                        <select name="essn" required style="width: 260px; padding: 6px;">
                            {% for e in all_employees %}
                                <option value="{{ e.ssn }}">{{ e.full_name }}</option>
                            {% endfor %}
                        </select>
                    </div>
                </div>
                <div class="info-row">
                    <div class="info-label">Hours to Add</div>
                    <div class="info-value">
                        <input type="number" name="hours" min="0.1" step="0.1" required style="width: 120px; padding: 6px;" />
                        <span style="color:#666; margin-left:8px;">Adds to existing hours if already assigned.</span>
                    </div>
                </div>
                <div style="text-align:right; margin-top:8px;">
                    <button type="submit" class="login-button">Save Assignment</button>
                </div>
            </form>
        </div>
    {% else %}
        <p>Project not found.</p>
    {% endif %}
</body>
</html>
