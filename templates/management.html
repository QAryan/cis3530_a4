<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
    <title>{{ title }}</title>
    <style>
            /* Local-only styles to align the Projects table without touching global styles.css */
            .projects-table { table-layout: fixed; width: 92%; margin: 0 auto; border-collapse: collapse; }
            /* Column widths tuned to avoid header wrapping and match screenshot */
            .projects-table col.col-num { width: 10%; }
            .projects-table col.col-name { width: 30%; }
            .projects-table col.col-dept { width: 24%; }
            .projects-table col.col-hc { width: 12%; }
            .projects-table col.col-dependents { width: 12%; }
            .projects-table col.col-projects { width: 12%; }
            .projects-table col.col-hours { width: 14%; }
            .projects-table col.col-actions { width: 10%; }
            .projects-table th, .projects-table td { border: 1px solid #ddd; padding: 10px 12px; }
            .projects-table th { background-color: #2c5ea9; color: white; }
    </style>
</head>
<body>
    <div class="header">
      <h1>MyCompany</h1>

      <!-- TABS -->
      <div class="tabs">
          <button class="tab" onclick="location.href='/'">Employees</button>
          <button class="tab" onclick="location.href='/projects'">Projects</button>
          <button class="tab" onclick="location.href='/departments'">Departments</button>
          <button class="tab-hovered" onclick="location.href='/employee_management'">Employee Management</button>
      </div>

      <!-- LOGIN -->
      <div class="login-section">
        {% if user == None %}
            <button class="login-button" onclick="location.href='/login'">Login</button>
            <p>or</p>
            <button class="login-button" onclick="location.href='/register'">Register</button>
        {% else %}
            <p class="login-user">{{ user.name }}</p>
            <button class="login-button" onclick="location.href='/logout'">Logout</button>
        {% endif %}
      </div>
    </div>

    <div class="spacer"></div>

    <!-- FLASH MESSAGES -->
    {% with messages = get_flashed_messages(with_categories=true) %}
      {% if messages %}
        <ul class="flashes">
        {% for category, message in messages %}
          <li class="{{ category }}">{{ message }}</li>
        {% endfor %}
        </ul>
      {% endif %}
    {% endwith %}
    <h1 class="title">Employee Management</h1>

    <div class="management-actions">
      <p>Welcome to the Employee Management section. Here you can manage employee records.</p>
      <button class="management-button" onclick="location.href='/employee_management/add'">Add a New Employee</button>
      
      <h3>Employees:</h3>

      <form class="filter-form" method="get" action="{{ url_for('employee_management') }}" id="filterForm">
          <!-- Department Filter -->
          <label for="department">Filter by Department:</label>
          <select class="filter-select" name="department" id="department">
              <option value="All" {% if selected_department == 'All' %}selected{% endif %}>All</option>
              {% for dept in departments %}
                  <option value="{{ dept }}" {% if selected_department == dept %}selected{% endif %}>{{ dept }}</option>
              {% endfor %}
          </select>

          <!-- Name Search -->
          <label for="name">Search by Name:</label>
          <input class="filter-input" type="text" name="name" id="name" value="{{ name_search }}" placeholder="Enter name...">
          <button class="filter-button" type="button" id="Search">Search</button>
          <button class="filter-button" type="button" id="clearSearch">Clear</button>
          <!-- Sorting Options -->
          <label for="sort_by">Sort by:</label>
          <select class="filter-select" name="sort_by" id="sort_by">
              <option value="full_name" {% if sort_by=='full_name' %}selected{% endif %}>Name</option>
              <option value="total_hours" {% if sort_by=='total_hours' %}selected{% endif %}>Hours</option>
          </select>

          <label for="sort_order">Order:</label>
          <select class="filter-select" name="sort_order" id="sort_order">
              <option value="asc" {% if sort_order=='asc' %}selected{% endif %}>Ascending</option>
              <option value="desc" {% if sort_order=='desc' %}selected{% endif %}>Descending</option>
          </select>
      </form>

      <!-- List of all Employees with actions -->
      <table class="projects-table">
      <colgroup>
        <col class="col-name">
        <col class="col-department">
        <col class="col-dependents">
        <col class="col-projects">
        <col class="col-hours">
        <col class="col-actions">
      <tr>
        <th>Employee Name</th>
        <th>Department</th>
        <th>Number of Dependents</th>
        <th>Number of Projects</th>
        <th>Total Hours</th>
        <th>Actions</th>
      </tr>
      {% for emp in employees %}
      <tr>
        <td>{{ emp.FullName }}</td>
        <td>{{ emp.Department }}</td>
        <td>{{ emp.Dependents }}</td>
        <td>{{ emp.Projects }}</td>
        <td>{{ emp.Hours }}</td>
        <td>
            <button class="management-action-button" onclick="location.href='/employee_management/edit/{{ emp.ssn }}'">Edit</button>
            <button class="management-action-button" onclick="if(confirm('Are you sure you want to delete this employee?')) { location.href='/employee_management/delete/{{ emp.ssn }}' }">Delete</button>
        </td>
      </tr>
      {% endfor %}
      </table>

    </div>

</body>
<script>
    const form = document.getElementById('filterForm');
    const clearBtn = document.getElementById('clearSearch');
    const nameInput = document.getElementById('name');
    const searchBtn = document.getElementById('Search');
    // Submit form whenever a filter or sort option changes
    document.getElementById('department').addEventListener('change', () => form.submit());
    document.getElementById('sort_by').addEventListener('change', () => form.submit());
    document.getElementById('sort_order').addEventListener('change', () => form.submit());
    function debounce(func, wait) {
    let timeout;
    return function(...args) {
        clearTimeout(timeout);
        timeout = setTimeout(() => func.apply(this, args), wait);
    };
}
searchBtn.addEventListener('click', () => form.submit());
// Submit form after user stops typing for 300ms
clearBtn.addEventListener('click', () => {
    nameInput.value = '';
    form.submit();
});
</script>
</html>